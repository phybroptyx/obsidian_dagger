---
# - name: Creating Server Objects
#   import_tasks: ../../common/tasks/win_configure_domain_server.yml    # Apply Server Configuration
#   vars:
#     config: "{{ dc_ad_server_config }}"
#     task_title: "Creating Server Objects"
#     process_wait: true
#     ignore_errors: false
#     # win_user: "{{ win_domain_admin }}"

- name: "Configuring Active Directory environment for the stark-industries.midgard.mrvl domain"
  community.vmware.vmware_vm_shell:
    hostname: "{{ vcenter_hostname }}"
    username: "{{ vcenter_username }}"
    password: "{{ vcenter_password }}"
    validate_certs: "{{ vcenter_validate_certs }}"
    datacenter: "{{ vcenter_datacenter }}"
    vm_id: "{{ vm }}"
    vm_username: "{{ win_domain_admin }}"
    vm_password: "{{ win_admin_password }}"
    vm_shell: 'C:\Windows\System32\WindowsPowershell\v1.0\powershell.exe'
    # vm_shell_args: '-ExecutionPolicy Bypass -Command { {{ config }} }'
    vm_shell_args: |
      Invoke-Command -ScriptBlock {
      Rename-ADObject -Identity "CN=Default-First-Site-Name,CN=Sites,CN=Configuration,DC=stark-industries,DC=midgard,DC=mrvl" -NewName "NYC"
      New-ADReplicationSubnet -Name "4.78.128.0/24" -Site "NYC"
      New-ADOrganizationalUnit -Name "STARK" -Path "DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADOrganizationalUnit -Name "Servers" -Path "OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADOrganizationalUnit -Name "Departments" -Path "OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADOrganizationalUnit -Name "Development" -Path "OU=Departments,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADOrganizationalUnit -Name "Human Resources" -Path "OU=Departments,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADOrganizationalUnit -Name "Operations" -Path "OU=Departments,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADOrganizationalUnit -Name "Research" -Path "OU=Departments,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADOrganizationalUnit -Name "Workstations" -Path "OU=Development,OU=Departments,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADOrganizationalUnit -Name "Linux Workstations" -Path "OU=Workstations,OU=Development,OU=Departments,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADOrganizationalUnit -Name "Windows Workstations" -Path "OU=Workstations,OU=Development,OU=Departments,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADOrganizationalUnit -Name "Users" -Path "OU=Development,OU=Departments,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADOrganizationalUnit -Name "Groups" -Path "OU=Development,OU=Departments,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADOrganizationalUnit -Name "Workstations" -Path "OU=Human Resources,OU=Departments,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADOrganizationalUnit -Name "Linux Workstations" -Path "OU=Workstations,OU=Human Resources,OU=Departments,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADOrganizationalUnit -Name "Windows Workstations" -Path "OU=Workstations,OU=Human Resources,OU=Departments,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADOrganizationalUnit -Name "Users" -Path "OU=Human Resources,OU=Departments,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADOrganizationalUnit -Name "Groups" -Path "OU=Human Resources,OU=Departments,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADOrganizationalUnit -Name "Workstations" -Path "OU=Operations,OU=Departments,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADOrganizationalUnit -Name "Linux Workstations" -Path "OU=Workstations,OU=Operations,OU=Departments,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADOrganizationalUnit -Name "Windows Workstations" -Path "OU=Workstations,OU=Operations,OU=Departments,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADOrganizationalUnit -Name "Users" -Path "OU=Operations,OU=Departments,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADOrganizationalUnit -Name "Groups" -Path "OU=Operations,OU=Departments,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADOrganizationalUnit -Name "Workstations" -Path "OU=Research,OU=Departments,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADOrganizationalUnit -Name "Linux Workstations" -Path "OU=Workstations,OU=Research,OU=Departments,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADOrganizationalUnit -Name "Windows Workstations" -Path "OU=Workstations,OU=Research,OU=Departments,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADOrganizationalUnit -Name "Users" -Path "OU=Research,OU=Departments,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADOrganizationalUnit -Name "Groups" -Path "OU=Research,OU=Departments,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADComputer -Name "stk-ex-01" -SamAccountName "stk-ex-01" -Path "OU=Servers,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADComputer -Name "stk-as-01" -SamAccountName "stk-as-01" -Path "OU=Servers,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADComputer -Name "stk-lhm-01" -SamAccountName "stk-lhm-01" -Path "OU=Servers,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADComputer -Name "stk-fhm-01" -SamAccountName "stk-fhm-01" -Path "OU=Servers,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADComputer -Name "stk-hst-01" -SamAccountName "stk-hst-01" -Path "OU=Servers,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADComputer -Name "stk-rsch-a29e5p" -SamAccountName "stk-rsch-a29e5p" -Path "OU=Windows Workstations,OU=Workstations,OU=Research,OU=Departments,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADComputer -Name "stk-rsch-62c271" -SamAccountName "stk-rsch-62c271" -Path "OU=Windows Workstations,OU=Workstations,OU=Research,OU=Departments,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADComputer -Name "stk-rsch-a87ffb" -SamAccountName "stk-rsch-a87ffb" -Path "OU=Windows Workstations,OU=Workstations,OU=Research,OU=Departments,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADComputer -Name "stk-rsch-6604ec" -SamAccountName "stk-rsch-6604ec" -Path "OU=Windows Workstations,OU=Workstations,OU=Research,OU=Departments,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADComputer -Name "stk-rsch-0aec35" -SamAccountName "stk-rsch-0aec35" -Path "OU=Windows Workstations,OU=Workstations,OU=Research,OU=Departments,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADComputer -Name "stk-rsch-28eddc" -SamAccountName "stk-rsch-28eddc" -Path "OU=Windows Workstations,OU=Workstations,OU=Research,OU=Departments,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADComputer -Name "stk-rsch-bc4dfe" -SamAccountName "stk-rsch-bc4dfe" -Path "OU=Linux Workstations,OU=Workstations,OU=Research,OU=Departments,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADComputer -Name "stk-dev-0f7d34" -SamAccountName "stk-dev-0f7d34" -Path "OU=Windows Workstations,OU=Workstations,OU=Development,OU=Departments,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADComputer -Name "stk-dev-99ba3e" -SamAccountName "stk-dev-99ba3e" -Path "OU=Windows Workstations,OU=Workstations,OU=Development,OU=Departments,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADComputer -Name "stk-dev-816dce" -SamAccountName "stk-dev-816dce" -Path "OU=Windows Workstations,OU=Workstations,OU=Development,OU=Departments,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADComputer -Name "stk-dev-bbae60" -SamAccountName "stk-dev-bbae60" -Path "OU=Windows Workstations,OU=Workstations,OU=Development,OU=Departments,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADComputer -Name "stk-dev-ac4834" -SamAccountName "stk-dev-ac4834" -Path "OU=Windows Workstations,OU=Workstations,OU=Development,OU=Departments,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADComputer -Name "stk-dev-ad26de" -SamAccountName "stk-dev-ad26de" -Path "OU=Linux Workstations,OU=Workstations,OU=Development,OU=Departments,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADComputer -Name "stk-dev-a27e28" -SamAccountName "stk-dev-a27e28" -Path "OU=Linux Workstations,OU=Workstations,OU=Development,OU=Departments,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADComputer -Name "stk-dev-77ffea" -SamAccountName "stk-dev-77ffea" -Path "OU=Linux Workstations,OU=Workstations,OU=Development,OU=Departments,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADComputer -Name "stk-dev-17dce4" -SamAccountName "stk-dev-17dce4" -Path "OU=Linux Workstations,OU=Workstations,OU=Development,OU=Departments,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADComputer -Name "stk-dev-29afec" -SamAccountName "stk-dev-29afec" -Path "OU=Linux Workstations,OU=Workstations,OU=Development,OU=Departments,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADComputer -Name "stk-dev-28eeca" -SamAccountName "stk-dev-28eeca" -Path "OU=Linux Workstations,OU=Workstations,OU=Development,OU=Departments,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADComputer -Name "stk-dev-0385dd" -SamAccountName "stk-dev-0385dd" -Path "OU=Linux Workstations,OU=Workstations,OU=Development,OU=Departments,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADComputer -Name "stk-dev-34fcea" -SamAccountName "stk-dev-34fcea" -Path "OU=Linux Workstations,OU=Workstations,OU=Development,OU=Departments,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADComputer -Name "stk-dev-e37ace" -SamAccountName "stk-dev-e37ace" -Path "OU=Linux Workstations,OU=Workstations,OU=Development,OU=Departments,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADComputer -Name "stk-dev-eee5ac" -SamAccountName "stk-dev-eee5ac" -Path "OU=Linux Workstations,OU=Workstations,OU=Development,OU=Departments,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADComputer -Name "stk-ops-7cb6b9" -SamAccountName "stk-ops-7cb6b9" -Path "OU=Windows Workstations,OU=Workstations,OU=Operations,OU=Departments,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADComputer -Name "stk-ops-26eacf" -SamAccountName "stk-ops-26eacf" -Path "OU=Windows Workstations,OU=Workstations,OU=Operations,OU=Departments,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADComputer -Name "stk-ops-173eeb" -SamAccountName "stk-ops-173eeb" -Path "OU=Windows Workstations,OU=Workstations,OU=Operations,OU=Departments,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADComputer -Name "stk-ops-100caa" -SamAccountName "stk-ops-100caa" -Path "OU=Windows Workstations,OU=Workstations,OU=Operations,OU=Departments,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADComputer -Name "stk-ops-547002" -SamAccountName "stk-ops-547002" -Path "OU=Windows Workstations,OU=Workstations,OU=Operations,OU=Departments,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADComputer -Name "stk-ops-bb6587" -SamAccountName "stk-ops-bb6587" -Path "OU=Windows Workstations,OU=Workstations,OU=Operations,OU=Departments,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADComputer -Name "stk-ops-26db55" -SamAccountName "stk-ops-26db55" -Path "OU=Linux Workstations,OU=Workstations,OU=Operations,OU=Departments,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADComputer -Name "stk-ops-5ae36b" -SamAccountName "stk-ops-5ae36b" -Path "OU=Linux Workstations,OU=Workstations,OU=Operations,OU=Departments,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADComputer -Name "stk-hr-950abe" -SamAccountName "stk-hr-950abe" -Path "OU=Windows Workstations,OU=Workstations,OU=Human Resources,OU=Departments,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADComputer -Name "stk-hr-264b4e" -SamAccountName "stk-hr-264b4e" -Path "OU=Windows Workstations,OU=Workstations,OU=Human Resources,OU=Departments,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADComputer -Name "stk-hr-29bcec" -SamAccountName "stk-hr-29bcec" -Path "OU=Windows Workstations,OU=Workstations,OU=Human Resources,OU=Departments,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADComputer -Name "stk-hr-cc8317" -SamAccountName "stk-hr-cc8317" -Path "OU=Windows Workstations,OU=Workstations,OU=Human Resources,OU=Departments,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADComputer -Name "stk-hr-93bace" -SamAccountName "stk-hr-93bace" -Path "OU=Windows Workstations,OU=Workstations,OU=Human Resources,OU=Departments,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADComputer -Name "stk-hr-ac3476" -SamAccountName "stk-hr-ac3476" -Path "OU=Windows Workstations,OU=Workstations,OU=Human Resources,OU=Departments,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      New-ADComputer -Name "stk-hr-819fed" -SamAccountName "stk-hr-819fed" -Path "OU=Windows Workstations,OU=Workstations,OU=Human Resources,OU=Departments,OU=STARK,DC=stark-industries,DC=midgard,DC=mrvl"
      } -credential (New-Object System.Management.Automation.PSCredential {{ win_domain_admin }}, (convertto-securestring $({{ win_admin_password }}) -asplaintext -force))
    wait_for_process: true